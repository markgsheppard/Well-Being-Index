<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economic Well-Being Index - Preview V8</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            color: #333;
        }

        .navbar {
            background-color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-brand h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }

        .nav-menu {
            list-style: none;
            display: flex;
            gap: 2rem;
        }

        .nav-menu a {
            text-decoration: none;
            color: #999;
            font-size: 0.85rem;
            transition: color 0.3s;
        }

        .nav-menu a:hover {
            color: #333;
        }

        .hero {
            text-align: center;
            padding: 3rem 2rem;
            background-color: #f8f8f8;
        }

        .hero h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }

        .hero .status {
            font-weight: 700;
            cursor: pointer;
            transition: color 0.3s;
            text-decoration: underline;
            text-decoration-color: rgba(0, 0, 0, 0.08);
            text-decoration-thickness: 0.5px;
            text-underline-offset: 4px;
        }

        .hero .status.has-value {
            text-decoration: none;
        }

        .hero .status:hover {
            opacity: 0.8;
        }

        .categories {
            background-color: white;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1400px;
        }

        .category-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 400;
        }

        .tab-btn:hover {
            color: #999;
        }

        .tab-btn.active-category {
            color: #333;
            font-weight: 700;
        }

        .subcategories {
            display: flex;
            justify-content: center;
            gap: 0.4rem;
            flex-wrap: wrap;
            min-height: 60px;
            align-items: center;
        }

        .subcategory-btn {
            background: transparent;
            border: none;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            color: #d0d0d0;
            cursor: pointer;
            border-radius: 0;
            transition: all 0.3s;
            font-weight: 400;
        }

        .subcategory-btn:hover {
            color: #aaa;
        }

        .subcategory-btn.active {
            color: #666;
            font-weight: 700;
        }

        .subcategory-btn.highlighted {
            background: #555;
            color: white;
            font-weight: 700;
        }

        .data-grid {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            min-height: 400px;
        }

        .data-card {
            color: white;
            padding: 2rem;
            border-radius: 0;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .data-card-title {
            font-size: 0.9rem;
            font-weight: 400;
            opacity: 0.95;
            margin-bottom: 1rem;
        }

        .data-card-value {
            font-size: 5.5rem;
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.02em;
            margin: 0.5rem 0;
        }

        .data-card-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 1rem;
        }

        .data-card-change {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .data-card {
            animation: fadeInUp 0.5s ease-out;
        }

        @media (max-width: 1400px) {
            .data-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1100px) {
            .data-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .hero h2 {
                font-size: 1.5rem;
            }
            
            .data-card-value {
                font-size: 3.5rem;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .data-grid {
                grid-template-columns: 1fr;
            }
        }

        .formula-section {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem 4rem;
            background-color: #ffffff;
            text-align: center;
            border-top: 1px solid #f8f8f8;
            padding-top: 2rem;
        }

        .formula-display {
            color: #d0d0d0;
            font-size: 0.75rem;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 400;
            line-height: 1.5;
        }

        .formula-display .index-score-label {
            font-weight: 700;
            color: #1889d7;
        }

        .formula-explanation {
            margin-top: 0.75rem;
            font-size: 0.65rem;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            color: #d0d0d0;
            line-height: 1.4;
        }

        footer {
            background-color: #f8f8f8;
            color: #777;
            padding: 2rem;
            text-align: left;
            margin-top: 4rem;
            font-size: 0.75rem;
            line-height: 1.3;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-content p {
            margin: 0.2rem 0;
            color: #777;
        }

        .footer-content a {
            color: #777;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-content a:hover {
            color: #333;
        }

        .social-links {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-start;
            gap: 1rem;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            color: #777;
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: #333;
        }

        .social-links svg {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1>The Economic Well-Being Index</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="#about">About</a></li>
                <li><a href="#news">News</a></li>
                <li><a href="#data">Data Releases</a></li>
                <li><a href="#press">Press</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h2>The Economy is <span class="status" id="economy-status">_____</span>.</h2>
        </section>

        <section class="categories">
            <div class="category-tabs">
                <button class="tab-btn" data-category="mobility">Mobility</button>
                <button class="tab-btn" data-category="poverty">Poverty</button>
                <button class="tab-btn" data-category="aggregates">Aggregates</button>
                <button class="tab-btn" data-category="labor">Labor</button>
                <button class="tab-btn" data-category="trade">Trade</button>
                <button class="tab-btn" data-category="finance">Finance</button>
            </div>

            <div class="subcategories" id="subcategories-container"></div>
        </section>

        <section class="data-grid" id="data-grid"></section>

        <section class="formula-section" id="formula-section" style="display: none;">
            <div id="formula-display"></div>
            <div class="formula-explanation" id="formula-explanation"></div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>365 5th Ave<br>
            New York, NY 10016<br>
            +1.408.384.2986<br>
            msheppard@gradcenter.cuny.edu</p>
            
            <div class="social-links">
                <a href="https://www.facebook.com/markgsheppard" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                </a>
                <a href="https://x.com/markgsheppard" target="_blank" rel="noopener noreferrer" aria-label="X">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
                <a href="https://bsky.app/profile/markgsheppard.com" target="_blank" rel="noopener noreferrer" aria-label="Bluesky">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" fill="currentColor">
                        <path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/>
                    </svg>
                </a>
            </div>
            
            <p style="margin-top: 1rem;">Copyright © 2025, Design and Visualizations by <a href="http://www.markgsheppard.com" target="_blank">Mark G. Sheppard</a>.</p>
        </div>
    </footer>


    <script>
        /*
        ============================================
        FRED API INTEGRATION
        ============================================
        API Key: 6352ad3b393d3ab83709630e61d2b14e
        Base URL: https://api.stlouisfed.org/fred/
        
        Example FRED Series IDs for Economic Indicators:
        - UNRATE: Unemployment Rate
        - CPIAUCSL: Consumer Price Index (CPI-U)
        - GDP: Gross Domestic Product
        - MORTGAGE30US: 30-Year Fixed Rate Mortgage Average
        - DEXUSEU: Euro to US Dollar Exchange Rate
        - SP500: S&P 500 Stock Price Index
        - DGS10: 10-Year Treasury Constant Maturity Rate
        - MEHOINUSA672N: Real Median Household Income
        - GINI: Gini Index of Income Inequality
        
        To integrate live FRED data:
        1. Replace fetchFREDData() placeholder with actual API calls
        2. Map FRED series IDs to your indicators
        3. Calculate normalized values based on historical ranges
        4. Update indicators in real-time or on page load
        
        Example API Call:
        https://api.stlouisfed.org/fred/series/observations?series_id=UNRATE&api_key=6352ad3b393d3ab83709630e61d2b14e&file_type=json&limit=1&sort_order=desc
        */

        // Color gradient configuration
        const colorStops = [
            { value: 0.0, color: { r: 223, g: 244, b: 255 } },  // #dff4ff (light)
            { value: 0.5, color: { r: 24, g: 137, b: 215 } },    // #1889d7 (true blue)
            { value: 1.0, color: { r: 10, g: 75, b: 120 } }      // #0a4b78 (dark)
        ];

        // FRED Series ID mapping (to be used with real API)
        const fredSeriesMapping = {
            'cpi-u': 'CPIAUCSL',
            'unemployment': 'UNRATE',
            'mortgage': 'MORTGAGE30US',
            'gdp': 'GDP',
            'stock-market': 'SP500',
            'trade-balance': 'BOPGSTB',
            'employment': 'EMRATIO',
            'poverty-rate': 'SIPOVGINIUSA'
        };

        // Placeholder function for FRED API integration
        async function fetchFREDData(seriesId) {
            /*
            const apiKey = '6352ad3b393d3ab83709630e61d2b14e';
            const url = `https://api.stlouisfed.org/fred/series/observations?series_id=${seriesId}&api_key=${apiKey}&file_type=json&limit=1&sort_order=desc`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                return parseFloat(data.observations[0].value);
            } catch (error) {
                console.error('Error fetching FRED data:', error);
                return null;
            }
            */
            
            // For now, return sample data
            // Replace this with actual API call above
            return null;
        }

        // Sample data (in production, this should come from FRED API)
        // NOTE: These are SAMPLE values for demonstration only
        // Real implementation should fetch from FRED using the API key above
        const data = {
            categories: [
                {
                    id: 'aggregates',
                    name: 'Aggregates',
                    subcategories: [
                        { 
                            id: 'cpi-u', 
                            name: 'CPI-U', 
                            highlighted: false, 
                            fredSeriesId: 'CPIAUCSL',
                            indicator: { 
                                name: 'CPI-U, Inflation', 
                                value: 2.7, 
                                format: 'decimal', 
                                description: 'Monthly Data, United States', 
                                normalizedValue: 0.73,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'unemployment', 
                            name: 'Unemployment', 
                            highlighted: false, 
                            fredSeriesId: 'UNRATE',
                            indicator: { 
                                name: 'U-3 Unemployment Rate', 
                                value: 4.6, 
                                format: 'decimal', 
                                description: 'in Percent, United States', 
                                normalizedValue: 0.95,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'mortgage', 
                            name: 'Gross Domestic Product', 
                            highlighted: false,
                            fredSeriesId: 'MORTGAGE30US',
                            indicator: { 
                                name: 'Mortgage Rate', 
                                value: 6.2, 
                                format: 'decimal', 
                                description: '30-Year Fixed', 
                                normalizedValue: 0.50,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'rent', 
                            name: 'GDP Growth Rate', 
                            highlighted: false,
                            fredSeriesId: 'GDP',
                            indicator: { 
                                name: 'Current Rent Amount', 
                                value: 1.9, 
                                format: 'decimal', 
                                description: 'in Thousands', 
                                change: 30, 
                                normalizedValue: 0.30,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'debt', 
                            name: 'Inflation Rate', 
                            highlighted: false,
                            indicator: { 
                                name: 'Household Debt Service Ratio', 
                                value: 11.3, 
                                format: 'decimal', 
                                description: 'in Percent of Disposable Income', 
                                normalizedValue: 0.68,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'deliquency', 
                            name: 'Consumer Price Index', 
                            highlighted: false,
                            indicator: { 
                                name: 'Debt Deliquency', 
                                value: 9.4, 
                                format: 'decimal', 
                                description: 'Student Debt 90+ Days Delinquent, in Percent', 
                                normalizedValue: 0.42,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'wealth-top', 
                            name: 'Producer Prices', 
                            highlighted: false,
                            indicator: { 
                                name: 'National Wealth Share', 
                                value: 31, 
                                format: 'integer', 
                                description: 'of Top 1% in the United States', 
                                normalizedValue: 0.18,
                                source: 'FRED'
                            }
                        },
                        { 
                            id: 'wealth-bottom', 
                            name: 'Personal Consumption', 
                            highlighted: false,
                            indicator: { 
                                name: 'National Wealth Share', 
                                value: 2.5, 
                                format: 'decimal', 
                                description: 'of Bottom 50% in the United States', 
                                normalizedValue: 0.08,
                                source: 'FRED'
                            }
                        }
                    ]
                },
                {
                    id: 'mobility',
                    name: 'Mobility',
                    subcategories: [
                        { 
                            id: 'income-mobility', 
                            name: 'Income Mobility', 
                            highlighted: false,
                            indicator: { 
                                name: 'Income Mobility Index', 
                                value: 45.3, 
                                format: 'decimal', 
                                description: 'Intergenerational Mobility', 
                                change: -2.1, 
                                normalizedValue: 0.60,
                                source: 'FRED'
                            }
                        }
                    ]
                },
                {
                    id: 'poverty',
                    name: 'Poverty',
                    subcategories: [
                        { 
                            id: 'poverty-rate', 
                            name: 'Poverty Rate', 
                            highlighted: false,
                            fredSeriesId: 'SIPOVGINIUSA',
                            indicator: { 
                                name: 'Poverty Rate', 
                                value: 12.4, 
                                format: 'decimal', 
                                description: 'Percent Below Poverty Line', 
                                change: 1.2, 
                                normalizedValue: 0.22,
                                source: 'FRED'
                            }
                        }
                    ]
                },
                {
                    id: 'labor',
                    name: 'Labor',
                    subcategories: [
                        { 
                            id: 'employment', 
                            name: 'Employment Rate', 
                            highlighted: false,
                            fredSeriesId: 'EMRATIO',
                            indicator: { 
                                name: 'Employment Rate', 
                                value: 60.1, 
                                format: 'decimal', 
                                description: 'Employment-Population Ratio', 
                                change: 0.3, 
                                normalizedValue: 0.78,
                                source: 'FRED'
                            }
                        }
                    ]
                },
                {
                    id: 'trade',
                    name: 'Trade',
                    subcategories: [
                        { 
                            id: 'trade-balance', 
                            name: 'Trade Balance', 
                            highlighted: false,
                            fredSeriesId: 'BOPGSTB',
                            indicator: { 
                                name: 'Trade Balance', 
                                value: -68.9, 
                                format: 'decimal', 
                                description: 'Billions USD', 
                                change: -5.2, 
                                normalizedValue: 0.12,
                                source: 'FRED'
                            }
                        }
                    ]
                },
                {
                    id: 'finance',
                    name: 'Finance',
                    subcategories: [
                        { 
                            id: 'stock-market', 
                            name: 'Stock Market', 
                            highlighted: false,
                            fredSeriesId: 'SP500',
                            indicator: { 
                                name: 'S&P 500 Index', 
                                value: 4783, 
                                format: 'integer', 
                                description: 'Stock Market Index', 
                                change: 12.5, 
                                normalizedValue: 0.92,
                                source: 'FRED'
                            }
                        }
                    ]
                }
            ]
        };

        let currentCategory = null;
        let selectedIndicators = [];

        const statusWords = [
            { min: 0.00, max: 0.20, word: 'Critical' },
            { min: 0.20, max: 0.35, word: 'Poor' },
            { min: 0.35, max: 0.50, word: 'Weak' },
            { min: 0.50, max: 0.65, word: 'Fair' },
            { min: 0.65, max: 0.75, word: 'Good' },
            { min: 0.75, max: 0.85, word: 'Strong' },
            { min: 0.85, max: 1.00, word: 'Excellent' }
        ];

        function interpolateColor(value) {
            value = Math.max(0, Math.min(1, value));
            
            let lower = colorStops[0];
            let upper = colorStops[colorStops.length - 1];
            
            for (let i = 0; i < colorStops.length - 1; i++) {
                if (value >= colorStops[i].value && value <= colorStops[i + 1].value) {
                    lower = colorStops[i];
                    upper = colorStops[i + 1];
                    break;
                }
            }
            
            const range = upper.value - lower.value;
            const relativeValue = range === 0 ? 0 : (value - lower.value) / range;
            
            const r = Math.round(lower.color.r + (upper.color.r - lower.color.r) * relativeValue);
            const g = Math.round(lower.color.g + (upper.color.g - lower.color.g) * relativeValue);
            const b = Math.round(lower.color.b + (upper.color.b - lower.color.b) * relativeValue);
            
            return `rgb(${r}, ${g}, ${b})`;
        }


        function updateFormulaDisplay() {
            const formulaSection = document.getElementById('formula-section');
            const formulaDisplay = document.getElementById('formula-display');
            const formulaExplanation = document.getElementById('formula-explanation');
            
            if (selectedIndicators.length === 0) {
                formulaSection.style.display = 'none';
                return;
            }
            
            formulaSection.style.display = 'block';
            
            const n = selectedIndicators.length;
            const weight = (1 / n).toFixed(3);
            const sum = selectedIndicators.reduce((acc, item) => acc + item.indicator.normalizedValue, 0);
            const average = sum / n;
            const scoreColor = interpolateColor(average);
            
            // Format score: one decimal unless needs more precision
            let scoreDisplay;
            const oneDecimal = average.toFixed(1);
            const threeDecimal = average.toFixed(3);
            if (Math.abs(parseFloat(oneDecimal) - average) > 0.01) {
                scoreDisplay = threeDecimal;
            } else {
                scoreDisplay = oneDecimal;
            }
            
            // Build formula as HTML
            let formulaHTML = '<span class="index-score-label" style="color: ' + scoreColor + ';">' + scoreDisplay + '</span> = ';
            
            selectedIndicators.forEach((item, index) => {
                let name = item.indicator.name.split(',')[0].trim().replace(/\([^)]*\)/g, '').trim();
                if (index > 0) formulaHTML += ' + ';
                formulaHTML += weight + ' · ' + name;
            });
            
            formulaDisplay.innerHTML = formulaHTML;
            
            // Build explanation
            const indicatorNames = selectedIndicators.map((item) => {
                return item.indicator.name.split(',')[0].trim().replace(/\([^)]*\)/g, '').trim();
            });
            
            let indicatorText;
            if (indicatorNames.length === 1) {
                indicatorText = indicatorNames[0];
            } else if (indicatorNames.length === 2) {
                indicatorText = indicatorNames.join(' and ');
            } else {
                const lastIndicator = indicatorNames.pop();
                indicatorText = indicatorNames.join(', ') + ', and ' + lastIndicator;
            }
            
            formulaExplanation.innerHTML = `
                <p>The Index Score is calculated by taking an equal-weighted average of the selected economic indicators. In this case, you've chosen ${indicatorText}, each receiving a weight of ${weight}. Each indicator's normalized value (ranging from zero to one) represents its relative performance compared to historical data, where higher values indicate stronger economic conditions. The weighted sum of these normalized values produces the overall index score of ${average.toFixed(3)}, which determines the economic status displayed above.</p>
            `;
        }

        function init() {
            setupEventListeners();
            updateUI();
        }

        function setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    selectCategory(e.target.dataset.category);
                });
            });
        }

        function selectCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active-category');
                if (btn.dataset.category === category) {
                    btn.classList.add('active-category');
                }
            });
            
            updateUI();
        }

        function toggleSubcategory(categoryId, subcategoryId) {
            const key = `${categoryId}:${subcategoryId}`;
            const index = selectedIndicators.findIndex(item => item.key === key);
            
            if (index > -1) {
                selectedIndicators.splice(index, 1);
            } else {
                const categoryData = data.categories.find(c => c.id === categoryId);
                const sub = categoryData.subcategories.find(s => s.id === subcategoryId);
                if (sub && sub.indicator) {
                    selectedIndicators.push({
                        key: key,
                        categoryId: categoryId,
                        subcategoryId: subcategoryId,
                        indicator: sub.indicator
                    });
                }
            }
            
            updateDataGrid();
            updateEconomyStatus();
            updateFormulaDisplay();
        }

        function updateEconomyStatus() {
            const statusElement = document.getElementById('economy-status');
            
            if (selectedIndicators.length === 0) {
                statusElement.textContent = '_____';
                statusElement.classList.remove('has-value');
                return;
            }

            const sum = selectedIndicators.reduce((acc, item) => acc + item.indicator.normalizedValue, 0);
            const average = sum / selectedIndicators.length;

            const status = statusWords.find(s => average >= s.min && average <= s.max);
            
            if (status) {
                statusElement.textContent = status.word;
                statusElement.style.color = interpolateColor(average);
                statusElement.classList.add('has-value');
            }
        }

        function updateUI() {
            updateSubcategories();
            updateDataGrid();
            updateFormulaDisplay();
        }

        function updateSubcategories() {
            const container = document.getElementById('subcategories-container');
            container.innerHTML = '';
            
            // Don't show subcategories if no category is selected
            if (!currentCategory) return;
            
            const categoryData = data.categories.find(c => c.id === currentCategory);
            if (!categoryData) return;
            
            categoryData.subcategories.forEach(sub => {
                const btn = document.createElement('button');
                btn.className = 'subcategory-btn';
                btn.textContent = sub.name;
                btn.dataset.subcategory = sub.id;
                
                if (sub.highlighted) {
                    btn.classList.add('highlighted');
                }
                
                const key = `${currentCategory}:${sub.id}`;
                if (selectedIndicators.some(item => item.key === key)) {
                    btn.classList.add('active');
                }
                
                btn.addEventListener('click', () => {
                    toggleSubcategory(currentCategory, sub.id);
                    
                    const key = `${currentCategory}:${sub.id}`;
                    if (selectedIndicators.some(item => item.key === key)) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                container.appendChild(btn);
            });
        }

        function updateDataGrid() {
            const grid = document.getElementById('data-grid');
            
            if (selectedIndicators.length === 0) {
                grid.innerHTML = '';
                return;
            }
            
            grid.innerHTML = '';
            
            selectedIndicators.forEach((item, index) => {
                const card = createDataCard(item.indicator, index);
                grid.appendChild(card);
            });
        }

        function createDataCard(indicator, index) {
            const card = document.createElement('div');
            card.className = 'data-card';
            
            const bgColor = interpolateColor(indicator.normalizedValue);
            card.style.backgroundColor = bgColor;
            
            let formattedValue = indicator.value;
            if (indicator.format === 'percent' || indicator.format === 'decimal') {
                formattedValue = indicator.value.toFixed(1);
            } else if (indicator.format === 'integer') {
                formattedValue = indicator.value.toLocaleString();
            }
            
            let changeHTML = '';
            if (indicator.change) {
                const changeSign = indicator.change > 0 ? '+' : '';
                changeHTML = `<div class="data-card-change">${changeSign}${indicator.change}%</div>`;
            }
            
            card.innerHTML = `
                <div class="data-card-title">${indicator.name}</div>
                <div class="data-card-value">${formattedValue}</div>
                <div class="data-card-subtitle">${indicator.description || ''}</div>
                ${changeHTML}
            `;
            
            return card;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
